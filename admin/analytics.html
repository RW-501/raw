<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Analytics - Photographer's Dashboard</title>

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">


        <link rel="stylesheet" href="../css/admin.css">
  
    <style>
        .loading {
            display: none;
        }

        .card-body {
            background-color: #f8f9fa;
        }

        .display-4 {
            font-size: 2rem;
            font-weight: 500;
        }

        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }

        .btn-primary:hover {
            background-color: #0056b3;
            border-color: #004085;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .analytics-card {
            transition: transform 0.3s;
        }

        .analytics-card:hover {
            transform: scale(1.05);
        }

        .error-message {
            color: red;
            font-weight: bold;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-left: auto;
            margin-right: auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

</head>
<body>



<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark">
    <a class="navbar-brand" href="https://shutterworx.co/">ShutterWorx </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a class="nav-link" href="../">Your Site</a>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="../admin/">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="../admin/media">Media</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="../admin/contact">Contact</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="../admin/design">Design</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="../admin/analytics">Analytics</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="../admin/transactions">Transactions</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="../admin/settings">Settings</a>
            </li>
        </ul>
    </div>
</nav>


<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="../admin/">Home</a></li>
      <li class="breadcrumb-item active" aria-current="page">Analytics</li>
    </ol>
  </nav>
  



        <main id="main-content">
        <section>
            <div class="container mt-5">
                <h2 class="text-center mb-4">Website Analytics Dashboard</h2>
                <section>
                    <div id="admin-messages" class="admin-messages-container">
                        <p id="message-text" class="fade-in"></p>
                        <div id="message-actions" class="message-actions"></div>
                    </div>
                </section>
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card analytics-card shadow-sm">
                            <div class="card-body">
                                <h5 class="section-title">Storage</h5>
                                <p id="spaceUsedDisplay" class="display-4">Loading...</p>
                                <div class="loading-spinner loading" id="loadingPageViews"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card analytics-card shadow-sm">
                            <div class="card-body">
                                <h5 class="section-title">Total Duration</h5>
                                <p id="totalDuration" class="display-4">Loading...</p>
                                <div class="loading-spinner loading" id="loadingImageDownloads"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card analytics-card shadow-sm">
                            <div class="card-body">
                                <h5 class="section-title">Total Users:</h5>
                                <p id="usersDisplay" class="display-4">Loading...</p>
                                <div class="loading-spinner loading" id="loadingEventPurchases"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card analytics-card shadow-sm">
                            <div class="card-body">
                                <h5 class="section-title">Total Messages</h5>
                                <p id="msgCountDisplay" class="display-4">Loading...</p>
                                <div class="loading-spinner loading" id="loadingUserEngagement"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Add more event-specific or general analytics as needed -->
            </div>
        </section>



<section>
            <title>User Analytics</title>
            <style>
              main {
                font-family: Arial, sans-serif;
                margin: 20px;
                background-color: #f4f4f9;
              }
              table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
              }
              th, td {
                padding: 12px;
                text-align: left;
                border: 1px solid #ddd;
              }
              th {
                background-color: #4CAF50;
                color: white;
              }
              tr:nth-child(even) {
                background-color: #f2f2f2;
              }

              section {
                margin: 3rem;
              }
            </style>
       
       
            <h1>User Analytics</h1>
            <div id="userAnalyticsTableContainer">
              <!-- The table will be injected here -->
            </div>
        </section>
        <section>

            <title>Event Analytics</title>
            <style>

              table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
              }
              th, td {
                padding: 12px;
                text-align: left;
                border: 1px solid #ddd;
              }
              th {
                background-color: #4CAF50;
                color: white;
              }
              tr:nth-child(even) {
                background-color: #f2f2f2;
              }
            </style>

            <h1>Event Analytics</h1>
            <div id="eventTableContainer">
              <!-- The table will be injected here -->
            </div>
          

        </section>

<section>


    <title>Media Overview</title>
    <style>


        .totals {
            margin-bottom: 20px;
        }

        .media-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .media-table th,
        .media-table td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
        }

        .media-table th {
            background-color: #f4f4f4;
        }

        .media-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
    </style>
    <h1>Media Collection Overview</h1>
    <div id="media-container"></div>

</section>






<section>

    <title>Contacts Management</title>
    <style>


        #contacts-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .contact-card {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 20px;
            width: 300px;
            background-color: #f9f9f9;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .contact-card h3 {
            margin-top: 0;
            color: #333;
        }

        .contact-card p {
            margin: 5px 0;
            color: #555;
        }

        .view-btn {
            display: inline-block;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            background-color: #007BFF;
            color: white;
            cursor: pointer;
            text-decoration: none;
            font-size: 14px;
        }

        .view-btn:hover {
            background-color: #0056b3;
        }
    </style>
    <h1>Contact Messages</h1>
    <div id="contacts-container"></div>

</section>

        <div class="error-message" id="errorMessage"></div>
    </main>



        
<!-- Footer -->
<footer class="bg-dark text-light py-3">
  <div class="container">
      <div class="row">
          <div class="col-md-6">
              <p>&copy; 2024 <a href="https://ShutterWorx.co" class="text-light">ShutterWorx</a> All rights reserved.</p>
          </div>
          <div class="col-md-6 text-md-right">
              <ul class="list-inline">
                  <li class="list-inline-item"><a href="https://ShutterWorx.co/FAQ" class="text-light">FAQs</a></li>
                  <li class="list-inline-item"><a href="https://ShutterWorx.co/join" class="text-light">Upgrade</a></li>
                  <li class="list-inline-item"><a href="https://ShutterWorx.co/contact" class="text-light">Contact Us</a></li>
                  <li class="list-inline-item"><a href="https://ShutterWorx.co/privacy" class="text-light">Privacy Policy</a></li>
                  <li class="list-inline-item"><a href="https://ShutterWorx.co/terms" class="text-light">Terms of Service</a></li>
              </ul>
          </div>
      </div>
  </div>
</footer>



<script src="../js/admin.js" ></script>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Firebase JS SDK and Custom Scripts -->
    <script type="module">
        import {  db,getStorage, ref, uploadBytes, getDownloadURL,
    doc,arrayUnion, RecaptchaVerifier ,increment, getDoc   ,signInWithPhoneNumber,
     query, updateDoc , setDoc, addDoc,signInAnonymously , orderBy,
      signInWithPopup,FacebookAuthProvider, GoogleAuthProvider,startAfter ,
       OAuthProvider, signOut, onAuthStateChanged, deleteDoc, getFirestore,
        createUserWithEmailAndPassword, signInWithEmailAndPassword, deleteObject,
         where, getDocs, storage, getAuth, collection, auth, analytics } from '../js/module.js';
    
       
         // Function to show loading spinner
        function showLoading(metric) {
         //   document.getElementById('loading' + metric.charAt(0).toUpperCase() + metric.slice(1)).style.display = 'inline-block';
         //   document.getElementById(metric).style.display = 'none';
        }
    
        // Function to hide loading spinner
        function hideLoading(metric) {
          //  document.getElementById('loading' + metric.charAt(0).toUpperCase() + metric.slice(1)).style.display = 'none';
         //   document.getElementById(metric).style.display = 'block';
        }
    
        // Function to display error message
        function displayError(message) {
            document.getElementById('errorMessage').textContent = message;
        }
    






/**
 * Helper function to format date and time based on specified options
 * @param {string} dateString - The date string to format
 * @param {Object} options - Formatting options
 * @returns {string} - Formatted date and time
 */
 function formatDate(dateInput, options = {}) {
  let date;

  // Check if the input is a Firestore timestamp object (with seconds and nanoseconds)
  if (dateInput && dateInput.seconds && dateInput.nanoseconds) {
    // Convert Firestore timestamp to JavaScript Date object
    date = new Date(dateInput.seconds * 1000 + dateInput.nanoseconds / 1000000);
  } else {
    // Parse the date string into a Date object
    date = new Date(dateInput);
  }

  // Check if the date is valid
  if (isNaN(date)) {
    console.error("Invalid date string:", dateInput);
    return "Invalid Date";
  }

  // Default formatting options
  const defaultOptions = {
    weekday: "long", // "Monday"
    year: "numeric", // "2024"
    month: "long", // "November"
    day: "numeric", // "21"
    hour: "numeric", // "12"
    minute: "numeric", // "11"
    second: "numeric", // "26"
    hour12: true // Use 12-hour clock with AM/PM
  };

  // Merge user options with defaults
  const finalOptions = { ...defaultOptions, ...options };

  // Return formatted date
  return date.toLocaleString("en-US", finalOptions);
}



// Function to format the "viewedBy" data into an HTML structure
function formatViewedBy(viewedByData = {}) {
  return `
    <ul>
      <li><strong>Duration of View:</strong> ${viewedByData.durationOfView || 'N/A'} seconds</li>
      <li><strong>Contact Views:</strong> ${viewedByData.contactViews || 'N/A'}</li>
      <li><strong>View Method:</strong> ${viewedByData.viewMethod || 'N/A'}</li>
      <li><strong>View Source:</strong> ${viewedByData.viewSource || 'N/A'}</li>
      <li><strong>View Date:</strong> ${viewedByData.viewDate ? formatDate(viewedByData.viewDate) : 'N/A'}</li>
    </ul>
  `;
}

// Function to toggle visibility of detail rows
function toggleDetailSection(rowId) {
  const detailRow = document.getElementById(`details-${rowId}`);
  if (detailRow) {
    detailRow.style.display = detailRow.style.display === 'none' ? 'table-row' : 'none';
  }
}

// Main function to display user analytics
async function displayUserAnalytics() {
  const analyticsData = await fetchUserAnalyticsData(); // Fetch the data
  const totalUsers = analyticsData.length;

  // Display the total user count
  document.getElementById('usersDisplay').innerHTML = `<h3>${totalUsers}</h3>`;

  // Construct the table structure
  let tableHTML = `
    <table>
      <thead>
        <tr>
          <th>IP Address</th>
          <th>City</th>
          <th>Country</th>
          <th>State</th>
          <th>Last View Date</th>
          <th>Total Duration (Seconds)</th>
          <th>Activities Count</th>
          <th>User Blocked</th>
        </tr>
      </thead>
      <tbody>
  `;

  analyticsData.forEach(user => {
    // Add main row
    tableHTML += `
      <tr>
        <td><button class="collapsible" onclick="toggleDetailSection('${user.ipAddress}')">${user.ipAddress}</button></td>
        <td>${user.city || 'N/A'}</td>
        <td>${user.country || 'N/A'}</td>
        <td>${user.state || 'N/A'}</td>
        <td>${user.lastViewDate ? formatDate(user.lastViewDate) : 'N/A'}</td>
        <td>${user.totalDuration || 0}</td>
        <td>${user.userActivitiesCount || 0}</td>
        <td>${user.userBlocked ? 'Yes' : 'No'}</td>
      </tr>
    `;

    // Filter out invalid `viewedBy` data
    const viewedByDetails = [
      user.contactViewedBy,
      user.eventDetailsViewedBy,
      user.homeViewedBy,
      user.aboutViewedBy,
      user.confirmationViewedBy,
      user.eventsViewedBy,
      user.galleryViewedBy
    ]
      .filter(detail => detail) // Exclude undefined, null, or empty values
      .map(detail => formatViewedBy(detail)) // Format valid entries
      .join(""); // Combine them into a single string

    // Only include the collapsible row if there are valid details
    if (viewedByDetails) {
      tableHTML += `
        <tr id="details-${user.ipAddress}" class="details-row" style="display: none;">
          <td colspan="8">
            <div class="user-details">
              <h4>Details for ${user.ipAddress}</h4>
              ${viewedByDetails}
            </div>
          </td>
        </tr>
      `;
    }
  });

  // Close table
  tableHTML += '</tbody></table>';

  // Insert the table into the container
  document.getElementById('userAnalyticsTableContainer').innerHTML = tableHTML;
}

// Fetch user analytics data from Firestore
async function fetchUserAnalyticsData() {
  const analyticsCollection = collection(db, "Analytics"); // Reference to the Analytics collection
  const analyticsSnapshot = await getDocs(analyticsCollection); // Fetch all documents
  const analyticsList = analyticsSnapshot.docs.map(doc => ({
    ipAddress: doc.id, // IP address as doc ID
    city: doc.data().city,
    country: doc.data().country,
    state: doc.data().state,
    totalDuration: doc.data().totalDuration,
    userActivitiesCount: doc.data().userActivitiesCount,
    userBlocked: doc.data().userBlocked || false,
    contactViewedBy: doc.data().contactViewedBy || {}, // Ensure fallback is an empty object
    eventDetailsViewedBy: doc.data().eventDetailsViewedBy || {}, 
    homeViewedBy: doc.data().homeViewedBy || {}, 
    aboutViewedBy: doc.data().aboutViewedBy || {}, 
    confirmationViewedBy: doc.data().confirmationViewedBy || {}, 
    eventsViewedBy: doc.data().eventsViewedBy || {}, 
    galleryViewedBy: doc.data().galleryViewedBy || {}, 
    lastViewDate: doc.data().lastViewDate,
  }));
  return analyticsList;
}

// Execute the function on page load
displayUserAnalytics();







async function displayEventAnalytics() {
      const events = await fetchEventsData();

      // Create a table
      let tableHTML = `
        <table>
          <thead>
            <tr>
              <th>Event Title</th>
              <th>Views</th>
            <th>Retrieve Count</th>
              <th>Status</th>
              <th>Public</th>
              <th>Event ID</th>
              <th>Add Date</th>
            </tr>
          </thead>
          <tbody>
      `;

      // Loop through events and create table rows
      events.forEach(event => {
        tableHTML += `
          <tr>
            <td>${event.title}</td>
            <td>${event.views}</td>
            <td>${event.retrieveCount}</td>
            <td>${event.status}</td>
            <td>${event.isPublic}</td>
            <td>${event.id}</td>
            <td>${formatDate(event.timestamp)}</td>
          </tr>
        `;
      });

      tableHTML += '</tbody></table>';

      // Insert the table into the container
      document.getElementById("eventTableContainer").innerHTML = tableHTML;
    }

async function fetchEventsData() {
  const eventsCollection = collection(db, "Events"); // reference to the Events collection
  const eventsSnapshot = await getDocs(eventsCollection); // fetch all documents in the collection
  const eventsList = eventsSnapshot.docs.map(doc => ({
    id: doc.id, // Document ID
    title: doc.data().title, // Title field
    views: doc.data().views, // Views field
    retrieveCount: doc.data().retrieveCount, 
    isPublic: doc.data().isPublic, 
    timestamp: doc.data().timestamp, 
    status: doc.data().status 
    
  }));
  return eventsList;
}























async function fetchAndRenderContacts() {
    // Reference to the Contacts collection in Firebase
    const contactsCollection = collection(db, "Contacts"); // Reference to the Contacts collection in Firestore
    
    try {
        // Fetch documents from the Contacts collection
        const snapshot = await getDocs(contactsCollection);
        const contacts = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
        }));

        // Render the contacts in the UI
        renderContacts(contacts);
    } catch (error) {
        console.error("Error fetching contacts:", error);
    }
}

function renderContacts(contacts) {
    const container = document.getElementById('contacts-container');
    if (!container) {
        console.error("Container not found!");
        return; // Exit if the container element is not found
    }

    container.innerHTML = ""; // Clear the container

    let unReadMsg = 0; // Counter for unread messages

    contacts.forEach(contact => {
        // Create a card for each contact
        const card = document.createElement('div');
        card.className = 'contact-card';

        // Populate the card with contact details
        card.innerHTML = `
            <h3>${contact.name || "No Name Provided"}</h3>
            <p><strong>Status:</strong> ${contact.status || "No Status"}</p>
            <p><strong>Subject:</strong> ${contact.subject || "No Subject"}</p>
            <p><strong>Messages:</strong> ${contact.messages || 0}</p>
            <p><strong>Timestamp:</strong> ${contact.timestamp ? new Date(contact.timestamp).toLocaleString() : "No Timestamp"}</p>
            <button class="view-btn" onclick="goToAdminContact('${contact.id}')">View Details</button>
        `;

        // Increment unread message count if the status is "unread"
        if (contact.status === "unread") {
            unReadMsg += 1;
        }

        // Append the card to the container
        container.appendChild(card);
    });

    // Update the display for total messages and unread messages
    const msgCountDisplay = document.getElementById('msgCountDisplay');
    if (msgCountDisplay) {
        msgCountDisplay.innerHTML = `
            <h3>Total Messages: ${contacts.length}</h3>
            <p>Unread Messages: ${unReadMsg}</p>
        `;
    } else {
        console.error("Message count display element not found.");
    }
}

function goToAdminContact(docId) {
    // Redirect to the admin contact page with the docId in the query string
    window.location.href = `/admin/contact?msg=${docId}`;
}



async function fetchAndRender(collectionName = "Media", renderFunction = renderMediaTable, loadingContainerId = "media-container") {
    const container = document.getElementById(loadingContainerId);
    if (!container) {
        console.error("Loading container not found!");
        return;
    }

    // Show loading message if the container is valid
    container.innerHTML = "<p>Loading...</p>";  // Optional: show loading message

    try {
        const collectionRef = collection(db, collectionName);
        const snapshot = await getDocs(collectionRef);
        const dataList = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data(),
        }));

        renderFunction(dataList); // Call the render function to display data
    } catch (error) {
        console.error(`Error fetching data from ${collectionName}:`, error);
        container.innerHTML = `<p>Error loading data. Please try again later.</p>`;
    }
}



// Helper function to format file size
function formatFileSize(sizeInBytes) {
    if (sizeInBytes < 1024) return `${sizeInBytes} B`;
    if (sizeInBytes < 1024 ** 2) return `${(sizeInBytes / 1024).toFixed(2)} KB`;
    if (sizeInBytes < 1024 ** 3) return `${(sizeInBytes / (1024 ** 2)).toFixed(2)} MB`;
    return `${(sizeInBytes / (1024 ** 3)).toFixed(2)} GB`;
}

// Render the media table
function renderMediaTable(mediaList, totalMediaCount, totalSpaceUsage) {
    const container = document.getElementById('media-container');
    if (!container) {
        console.error("Media container not found.");
        return;
    }

    // Display totals
    const totals = document.getElementById('spaceUsedDisplay');
    if (totals) {
        totals.className = 'totals';
        totals.innerHTML = `
            <p><strong>Total Media:</strong> ${totalMediaCount}</p>
            <p><strong>Total Space Usage:</strong> ${totalSpaceUsage}</p>
        `;
    }

    // Create table
    const table = document.createElement('table');
    table.className = 'media-table';
    table.innerHTML = `
        <thead>
            <tr>
                <th>Event ID</th>
                <th>Views</th>
                <th>Price</th>
                <th>File Size</th>
                <th>File Type</th>
                <th>Is Public</th>
                <th>Status</th>
                <th>Deactivated</th>
            </tr>
        </thead>
        <tbody>
            ${mediaList.map(media => `
                <tr>
                    <td>${media.eventId || "N/A"}</td>
                    <td>${media.views || 0}</td>
                    <td>${media.price || 0}</td>
                    <td>${formatFileSize(media.fileSize || 0)}</td>
                    <td>${media.fileType || "Unknown"}</td>
                    <td>${media.isPublic ? "Yes" : "No"}</td>
                    <td>${media.status || "N/A"}</td>
                    <td>${media.deactivated ? "Yes" : "No"}</td>
                </tr>
            `).join('')}
        </tbody>
    `;
    container.appendChild(table);
}


window.toggleDetailSection  = toggleDetailSection ;

       
// Window onload event to fetch data when the page loads
        window.onload = function () {
            const urlParams = new URLSearchParams(window.location.search);
            const eventId = urlParams.get("eventId");



            if (eventId) {
              //  fetchEventAnalytics(eventId);  // Fetch data for the specific event
            } else {
              //  fetchAnalyticsData();  // Fetch general analytics data
            }
            // my Analyics
            fetchEventsData();
            fetchUserAnalyticsData();
   // Display user analytics when the page loads
   displayUserAnalytics();
  
    // Display event analytics when the page loads
    displayEventAnalytics();

// Call the function on page load
fetchAndRenderContacts();

fetchAndRender();


        };
    
        function displayUserTrendAnalysis(analyticsData) {
  const trendData = analyticsData.reduce((acc, user) => {
    const date = new Date(user.lastViewDate).toLocaleDateString(); // Aggregate by date
    if (!acc[date]) {
      acc[date] = { totalDuration: 0, activitiesCount: 0, blockedCount: 0 };
    }
    acc[date].totalDuration += user.totalDuration;
    acc[date].activitiesCount += user.userActivitiesCount;
    if (user.userBlocked) acc[date].blockedCount++;
    return acc;
  }, {});

  // Display aggregated trend data as a graph
  displayTrendAnalysis(trendData);
}

function generateActionableInsights(analyticsData) {
  const totalUsers = analyticsData.length;
  const peakTimes = calculatePeakTimes(analyticsData);
  const blockedUsers = analyticsData.filter(user => user.userBlocked).length;
  
  const insights = [];
  
  if (blockedUsers / totalUsers > 0.1) {
    insights.push("Consider reviewing the user blocking criteria, as 10% of users are blocked.");
  }

  if (peakTimes.length > 0) {
    insights.push(`Consider scheduling promotions around peak times: ${peakTimes.join(', ')}`);
  }

  // Add more recommendations based on further data analysis

  return insights;
}

function calculateUserEngagementScore(user) {
  return user.totalDuration * 0.5 + user.userActivitiesCount * 0.3 + (user.userBlocked ? 0 : 10);
}
function crossAnalyzeUserEventData(userData, eventData) {
  const eventViews = eventData.reduce((acc, event) => {
    acc[event.id] = event.views;
    return acc;
  }, {});

  userData.forEach(user => {
    const interactedEvents = user.eventsViewedBy || [];
    interactedEvents.forEach(eventId => {
      if (eventViews[eventId]) {
        console.log(`User ${user.ipAddress} interacted with event ${eventId}, which has ${eventViews[eventId]} views.`);
      }
    });
  });
}


        // Display trend data on the trend chart
        function displayTrendAnalysis(data) {
            const ctx = document.getElementById('trendChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Page Views',
                        data: data.pageViews,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Number of Views'
                            }
                        }
                    }
                }
            });
        }
    
    </script>
    

    
</body>

</html>
