<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Analytics - Photographer's Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.0.2/firebase-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.0.2/firebase-analytics.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.0.2/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .loading {
            display: none;
        }

        .card-body {
            background-color: #f8f9fa;
        }

        .display-4 {
            font-size: 2rem;
            font-weight: 500;
        }

        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }

        .btn-primary:hover {
            background-color: #0056b3;
            border-color: #004085;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .analytics-card {
            transition: transform 0.3s;
        }

        .analytics-card:hover {
            transform: scale(1.05);
        }

        .error-message {
            color: red;
            font-weight: bold;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-left: auto;
            margin-right: auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>

<body>

    <div class="container mt-5">
        <h2 class="text-center mb-4">Website Analytics Dashboard</h2>

        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card analytics-card shadow-sm">
                    <div class="card-body">
                        <h5 class="section-title">Page Views</h5>
                        <p id="pageViews" class="display-4">Loading...</p>
                        <div class="loading-spinner loading" id="loadingPageViews"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card analytics-card shadow-sm">
                    <div class="card-body">
                        <h5 class="section-title">Image Downloads</h5>
                        <p id="imageDownloads" class="display-4">Loading...</p>
                        <div class="loading-spinner loading" id="loadingImageDownloads"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card analytics-card shadow-sm">
                    <div class="card-body">
                        <h5 class="section-title">Event Purchases</h5>
                        <p id="eventPurchases" class="display-4">Loading...</p>
                        <div class="loading-spinner loading" id="loadingEventPurchases"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card analytics-card shadow-sm">
                    <div class="card-body">
                        <h5 class="section-title">User Engagement</h5>
                        <p id="userEngagement" class="display-4">Loading...</p>
                        <div class="loading-spinner loading" id="loadingUserEngagement"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-body">
                <h5 class="section-title">Trend Analysis</h5>
                <canvas id="trendChart"></canvas>
            </div>
        </div>

        <div class="mb-4">
            <label for="customDateRange" class="form-label">Select Date Range</label>
            <input type="date" id="startDate" class="form-control d-inline-block" style="width: 48%;" />
            <input type="date" id="endDate" class="form-control d-inline-block" style="width: 48%;" />
            <button class="btn btn-primary mt-3" onclick="updateAnalytics()">Update Data</button>
        </div>

        <div class="error-message" id="errorMessage"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const analytics = firebase.analytics(app);

        async function fetchAnalyticsData() {
            showLoading('pageViews');
            try {
                const metricsRef = db.collection('analytics').doc('metrics');
                const metricsDoc = await metricsRef.get();
                const metricsData = metricsDoc.data();

                document.getElementById('pageViews').textContent = metricsData.pageViews || '0';
                document.getElementById('imageDownloads').textContent = metricsData.imageDownloads || '0';
                document.getElementById('eventPurchases').textContent = metricsData.eventPurchases || '0';
                document.getElementById('userEngagement').textContent = metricsData.userEngagement || '0';

                hideLoading('pageViews');
            } catch (error) {
                displayError("Failed to load analytics data.");
            }
        }

        function displayTrendAnalysis(data) {
            const ctx = document.getElementById('trendChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Page Views',
                        data: data.pageViews,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Number of Views'
                            }
                        }
                    }
                }
            });
        }

        async function fetchTrendData() {
            try {
                const trendRef = db.collection('analytics').doc('trendData');
                const trendDoc = await trendRef.get();
                const trendData = trendDoc.data();

                const data = {
                    labels: trendData.dates || [],
                    pageViews: trendData.pageViews || []
                };

                displayTrendAnalysis(data);
            } catch (error) {
                displayError("Failed to load trend data.");
            }
        }

        async function updateAnalytics() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            showLoading('pageViews');
            try {
                const rangeRef = db.collection('analytics')
                    .where('date', '>=', new Date(startDate))
                    .where('date', '<=', new Date(endDate));
                const rangeSnapshot = await rangeRef.get();

                let pageViews = 0;
                let imageDownloads = 0;
                let eventPurchases = 0;

                rangeSnapshot.forEach(doc => {
                    const data = doc.data();
                    pageViews += data.pageViews || 0;
                    imageDownloads += data.imageDownloads || 0;
                    eventPurchases += data.eventPurchases || 0;
                });

                document.getElementById('pageViews').textContent = pageViews;
                document.getElementById('imageDownloads').textContent = imageDownloads;
                document.getElementById('eventPurchases').textContent = eventPurchases;

                hideLoading('pageViews');
            } catch (error) {
                displayError("Failed to update analytics.");
            }
        }

        function showLoading(metric) {
            document.getElementById('loading' + metric.charAt(0).toUpperCase() + metric.slice(1)).style.display = 'inline-block';
            document.getElementById(metric).style.display = 'none';
        }

        function hideLoading(metric) {
            document.getElementById('loading' + metric.charAt(0).toUpperCase() + metric.slice(1)).style.display = 'none';
            document.getElementById(metric).style.display = 'block';
        }

        function displayError(message) {
            document.getElementById('errorMessage').textContent = message;
        }

        window.onload = function () {
            fetchAnalyticsData();
            fetchTrendData();
        };
    </script>
</body>

</html>
