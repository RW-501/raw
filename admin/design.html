<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Editing - Photographer's Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.0.2/firebase-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.0.2/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.0.2/firebase-storage.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ckeditor5@36.0.1/build/ckeditor.js"></script>
</head>
<body>

<div class="container mt-5">
    <h2 class="text-center mb-4">Website Editing Dashboard</h2>

    <!-- Edit About Page Section -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Edit About Page</h5>
            <form id="aboutForm">
                <div class="mb-3">
                    <label for="bio" class="form-label">Bio</label>
                    <textarea class="form-control" id="bioEditor"></textarea>
                </div>
                <div class="mb-3">
                    <label for="specialties" class="form-label">Specialties</label>
                    <textarea class="form-control" id="specialtiesEditor"></textarea>
                </div>
                <div class="mb-3">
                    <label for="awards" class="form-label">Awards</label>
                    <textarea class="form-control" id="awardsEditor"></textarea>
                </div>
                <div class="mb-3">
                    <label for="profilePic" class="form-label">Profile Picture</label>
                    <input type="file" class="form-control" id="profilePic" accept="image/*">
                </div>
                <div class="mb-3">
                    <label for="testimonials" class="form-label">Client Testimonials</label>
                    <textarea class="form-control" id="testimonials"></textarea>
                </div>
                <button type="button" class="btn btn-primary" onclick="updateAboutPage()">Save About Page</button>
            </form>
        </div>
    </div>

    <!-- Modify Public Gallery Section -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Manage Gallery</h5>
            <input type="file" id="galleryUpload" class="form-control" multiple>
            <button type="button" class="btn btn-primary mt-3" onclick="uploadGalleryImages()">Upload Images</button>

            <div id="galleryList" class="mt-3">
                <h6>Gallery Images</h6>
                <ul id="galleryImages" class="list-group">
                    <!-- Gallery Images will be listed here -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Manage Event Details Section -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Manage Events</h5>
            <form id="eventForm">
                <div class="mb-3">
                    <label for="eventTitle" class="form-label">Event Title</label>
                    <input type="text" class="form-control" id="eventTitle">
                </div>
                <div class="mb-3">
                    <label for="eventDescription" class="form-label">Event Description</label>
                    <textarea class="form-control" id="eventDescription"></textarea>
                </div>
                <div class="mb-3">
                    <label for="eventDate" class="form-label">Event Date</label>
                    <input type="date" class="form-control" id="eventDate">
                </div>
                <div class="mb-3">
                    <label for="eventImage" class="form-label">Event Image</label>
                    <input type="file" class="form-control" id="eventImage" accept="image/*">
                </div>
                <button type="button" class="btn btn-primary" onclick="updateEventDetails()">Save Event</button>
            </form>
        </div>
    </div>
</div>



<div id="loadingSpinner" style="display: none;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    Uploading images, please wait...
</div>


<script src="../js/main.js" ></script>
<script src="../js/module.js" type="module"></script>

<!-- Firebase JS SDK and Custom Scripts -->
<script type="module">
  import {  db, doc,getDoc, query, updateDoc,
  setDoc,     signInWithPopup,
  GoogleAuthProvider,
  FacebookAuthProvider,
  OAuthProvider,arrayUnion ,
  signOut, addDoc , increment,
  onAuthStateChanged,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  where, getDocs, storage, collection, auth, analytics  } from '../js/module.js';


    // Editor setup for About Page
    let bioEditor, specialtiesEditor, awardsEditor;

    // Initialize CKEditor for rich text editing
    ClassicEditor.create(document.querySelector('#bioEditor')).then(editor => { bioEditor = editor; });
    ClassicEditor.create(document.querySelector('#specialtiesEditor')).then(editor => { specialtiesEditor = editor; });
    ClassicEditor.create(document.querySelector('#awardsEditor')).then(editor => { awardsEditor = editor; });

    // Function to update the About Page details
    async function updateAboutPage() {
    try {
        const bio = bioEditor.getData();
        const specialties = specialtiesEditor.getData();
        const awards = awardsEditor.getData();
        const testimonials = document.getElementById('testimonials').value;
        const profilePic = document.getElementById('profilePic').files[0];

        let profilePicUrl = '';
        if (profilePic) {
            const profilePicRef = storage.ref(`about/profilePic/${profilePic.name}`);
            await profilePicRef.put(profilePic);
            profilePicUrl = await profilePicRef.getDownloadURL();
        }

        await db.collection('about').doc('photographerInfo').set({
            bio,
            specialties,
            awards,
            testimonials,
            profilePicUrl
        });

        alert('About Page updated successfully');
    } catch (error) {
        console.error('Error updating About Page:', error);
        alert('There was an error updating the About Page. Please try again later.');
    }
}


    // Function to upload gallery images and descriptions
    async function uploadGalleryImages() {
    try {
        const files = document.getElementById('galleryUpload').files;
        const galleryImages = document.getElementById('galleryImages');
        
        for (const file of files) {
            const galleryRef = storage.ref(`gallery/${file.name}`);
            await galleryRef.put(file);
            const imageUrl = await galleryRef.getDownloadURL();

            const listItem = document.createElement('li');
            listItem.classList.add('list-group-item');
            listItem.innerHTML = `
                <img src="${imageUrl}" alt="Gallery Image" style="width: 100px; height: 100px;">
                <input type="text" class="form-control mt-2" placeholder="Enter image description">
                <button type="button" class="btn btn-warning btn-sm mt-2" onclick="markAsFeatured('${imageUrl}')">Mark as Featured</button>
                <button type="button" class="btn btn-danger btn-sm mt-2" onclick="removeImage('${imageUrl}')">Remove Image</button>
            `;
            galleryImages.appendChild(listItem);
        }
    } catch (error) {
        console.error('Error uploading gallery images:', error);
        alert('There was an error uploading the images. Please try again.');
    }

    galleryImages.appendChild(fragment);  // Append all items at once
}

    // Function to mark an image as featured
    async function markAsFeatured(imageUrl) {
        await db.collection('gallery').doc('featured').set({ imageUrl }, { merge: true });
        alert('Image marked as featured');
    }

    // Function to remove an image from the gallery
    async function removeImage(imageUrl) {
        const galleryImages = document.getElementById('galleryImages');
        galleryImages.querySelector(`img[src="${imageUrl}"]`).parentElement.remove();
        await storage.refFromURL(imageUrl).delete();
        alert('Image removed from gallery');
    }

    // Function to update event details
    async function updateEventDetails() {
    const eventTitle = document.getElementById('eventTitle').value;
    const eventDescription = document.getElementById('eventDescription').value;
    const eventDate = document.getElementById('eventDate').value;
    const eventImage = document.getElementById('eventImage').files[0];

    if (!eventTitle || !eventDescription || !eventDate) {
        alert('Please fill in all event details.');
        return;
    }

    let eventImageUrl = '';
    if (eventImage) {
        const eventImageRef = storage.ref(`events/${eventImage.name}`);
        await eventImageRef.put(eventImage);
        eventImageUrl = await eventImageRef.getDownloadURL();
    }

    await db.collection('events').doc(eventTitle).set({
        eventDescription,
        eventDate,
        eventImageUrl
    });

    alert('Event updated successfully');
}

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
