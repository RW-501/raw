<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Editing - Photographer's Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.0.2/firebase-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.0.2/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.0.2/firebase-storage.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ckeditor5@36.0.1/build/ckeditor.js"></script>

    <style src="../css/admin.css"></style>

</head>
<body>


<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark">
    <a class="navbar-brand" href="../admin/index">ShutterWorx Admin</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a class="nav-link" href="../admin/analytics">Analytics</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="../admin/contact">Contact</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="../admin/design">Design</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="../admin/index">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="../admin/media">Media</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="../admin/transactions">Transactions</a>
            </li>
        </ul>
    </div>
</nav>


<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="../admin/">Home</a></li>
      <li class="breadcrumb-item active" aria-current="page">About</li>
    </ol>
  </nav>
  


  <main id="main-content">

<div class="container mt-5">
    <h2 class="text-center mb-4">Website Editing Dashboard</h2>

    <!-- Edit About Page Section -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Edit About Page</h5>
            <form id="aboutForm">
                <div class="mb-3">
                    <label for="bio" class="form-label">Bio</label>
                    <textarea class="form-control" id="bioEditor"></textarea>
                </div>
                <div class="mb-3">
                    <label for="specialties" class="form-label">Specialties</label>
                    <textarea class="form-control" id="specialtiesEditor"></textarea>
                </div>
                <div class="mb-3">
                    <label for="awards" class="form-label">Awards</label>
                    <textarea class="form-control" id="awardsEditor"></textarea>
                </div>
                <div class="mb-3">
                    <label for="profilePic" class="form-label">Profile Picture</label>
                    <input type="file" class="form-control" id="profilePic" accept="image/*">
                </div>
                <div class="mb-3">
                    <label for="testimonials" class="form-label">Client Testimonials</label>
                    <textarea class="form-control" id="testimonials"></textarea>
                </div>
                <button type="button" class="btn btn-primary" onclick="updateAboutPage()">Save About Page</button>
            </form>
        </div>
    </div>

    <!-- Modify Public Gallery Section -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Manage Gallery</h5>
            <input type="file" id="galleryUpload" class="form-control" multiple>
            <button type="button" class="btn btn-primary mt-3" onclick="uploadGalleryImages()">Upload Images</button>

            <div id="galleryList" class="mt-3">
                <h6>Gallery Images</h6>
                <ul id="galleryImages" class="list-group">
                    <!-- Gallery Images will be listed here -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Manage Event Details Section -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Manage Events</h5>
            <form id="eventForm">
                <div class="mb-3">
                    <label for="eventTitle" class="form-label">Event Title</label>
                    <input type="text" class="form-control" id="eventTitle">
                </div>
                <div class="mb-3">
                    <label for="eventDescription" class="form-label">Event Description</label>
                    <textarea class="form-control" id="eventDescription"></textarea>
                </div>
                <div class="mb-3">
                    <label for="eventDate" class="form-label">Event Date</label>
                    <input type="date" class="form-control" id="eventDate">
                </div>
                <div class="mb-3">
                    <label for="eventImage" class="form-label">Event Image</label>
                    <input type="file" class="form-control" id="eventImage" accept="image/*">
                </div>
                <button type="button" class="btn btn-primary" onclick="updateEventDetails()">Save Event</button>
            </form>
        </div>
    </div>
</div>



<div id="loadingSpinner" style="display: none;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    Uploading images, please wait...
</div>




</main>
<!-- Footer -->
<footer class="bg-dark text-light py-3">
  <div class="container">
      <div class="row">
          <div class="col-md-6">
              <p>&copy; 2024 <a href="https://ShutterWorx.co" class="text-light">ShutterWorx</a> All rights reserved.</p>
          </div>
          <div class="col-md-6 text-md-right">
              <ul class="list-inline">
                  <li class="list-inline-item"><a href="https://ShutterWorx.co/FAQ" class="text-light">FAQs</a></li>
                  <li class="list-inline-item"><a href="https://ShutterWorx.co/join" class="text-light">Upgrade</a></li>
                  <li class="list-inline-item"><a href="https://ShutterWorx.co/contact" class="text-light">Contact Us</a></li>
                  <li class="list-inline-item"><a href="https://ShutterWorx.co/privacy" class="text-light">Privacy Policy</a></li>
                  <li class="list-inline-item"><a href="https://ShutterWorx.co/terms" class="text-light">Terms of Service</a></li>
              </ul>
          </div>
      </div>
  </div>
</footer>


<script src="../js/main.js" ></script>
<script src="../js/admin.js" ></script>

<!-- Firebase JS SDK and Custom Scripts -->
<script type="module">
  import {  db, doc,getDoc, query, updateDoc,
  setDoc,     signInWithPopup,
  GoogleAuthProvider,
  FacebookAuthProvider,
  OAuthProvider,arrayUnion ,
  signOut, addDoc , increment,
  onAuthStateChanged,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  where, getDocs, storage, collection, auth, analytics  } from '../js/module.js';

// Editor setup for About Page
let bioEditor, specialtiesEditor, awardsEditor;

// Initialize CKEditor for rich text editing
const editorSetup = async () => {
    bioEditor = await ClassicEditor.create(document.querySelector('#bioEditor'));
    specialtiesEditor = await ClassicEditor.create(document.querySelector('#specialtiesEditor'));
    awardsEditor = await ClassicEditor.create(document.querySelector('#awardsEditor'));
};
editorSetup();

// Function to update the About Page details
async function updateAboutPage() {
    try {
        const bio = bioEditor.getData();
        const specialties = specialtiesEditor.getData();
        const awards = awardsEditor.getData();
        const testimonials = document.getElementById('testimonials').value;
        const profilePic = document.getElementById('profilePic').files[0];
        let profilePicUrl = '';

        if (profilePic) {
            const profilePicRef = storage.ref(`about/profilePic/${profilePic.name}`);
            await profilePicRef.put(profilePic);
            profilePicUrl = await profilePicRef.getDownloadURL();
        }

        await db.collection('AboutPage').doc('photographerInfo').set({
            bio,
            specialties,
            awards,
            testimonials,
            profilePicUrl
        });

        showToast('About Page updated successfully');
    } catch (error) {
        console.error('Error updating About Page:', error);
        showToast('Error updating About Page. Please try again later.');
    }
}
window.updateAboutPage = updateAboutPage;

// Function to upload gallery images and descriptions
async function uploadGalleryImages() {
    try {
        const files = document.getElementById('galleryUpload').files;
        const galleryImages = document.getElementById('galleryImages');
        const fragment = document.createDocumentFragment();

        for (const file of files) {
            const galleryRef = storage.ref(`gallery/${file.name}`);
            await galleryRef.put(file);
            const imageUrl = await galleryRef.getDownloadURL();

            const listItem = document.createElement('li');
            listItem.classList.add('list-group-item');
            listItem.innerHTML = `
                <img src="${imageUrl}" alt="Gallery Image" style="width: 100px; height: 100px;">
                <input type="text" class="form-control mt-2" placeholder="Enter image description">
                <button type="button" class="btn btn-warning btn-sm mt-2" onclick="markAsFeatured('${imageUrl}')">Mark as Featured</button>
                <button type="button" class="btn btn-danger btn-sm mt-2" onclick="removeImage('${imageUrl}')">Remove Image</button>
            `;
            fragment.appendChild(listItem);
        }

        galleryImages.appendChild(fragment);
        showToast('Gallery images uploaded successfully');
    } catch (error) {
        console.error('Error uploading gallery images:', error);
        showToast('Error uploading images. Please try again.');
    }
}
window.uploadGalleryImages = uploadGalleryImages;

// Function to mark an image as featured
async function markAsFeatured(imageUrl) {
    try {
        await db.collection('gallery').doc('featured').set({ imageUrl }, { merge: true });
        showToast('Image marked as featured');
    } catch (error) {
        console.error('Error marking image as featured:', error);
        showToast('Error marking image. Please try again.');
    }
}
window.markAsFeatured = markAsFeatured;

// Function to remove an image from the gallery
async function removeImage(imageUrl) {
    try {
        const galleryImages = document.getElementById('galleryImages');
        galleryImages.querySelector(`img[src="${imageUrl}"]`).parentElement.remove();
        await storage.refFromURL(imageUrl).delete();
        showToast('Image removed from gallery');
    } catch (error) {
        console.error('Error removing image:', error);
        showToast('Error removing image. Please try again.');
    }
}
window.removeImage = removeImage;

// Function to update event details
async function updateEventDetails() {
    try {
        const eventTitle = document.getElementById('eventTitle').value;
        const eventDescription = document.getElementById('eventDescription').value;
        const eventDate = document.getElementById('eventDate').value;
        const eventImage = document.getElementById('eventImage').files[0];

        if (!eventTitle || !eventDescription || !eventDate) {
            showToast('Please fill in all event details.');
            return;
        }

        let eventImageUrl = '';
        if (eventImage) {
            const eventImageRef = storage.ref(`events/${eventImage.name}`);
            await eventImageRef.put(eventImage);
            eventImageUrl = await eventImageRef.getDownloadURL();
        }

        await db.collection('Events').doc(eventTitle).set({
            eventDescription,
            eventDate,
            eventImageUrl
        });

        showToast('Event updated successfully');
    } catch (error) {
        console.error('Error updating event details:', error);
        showToast('Error updating event. Please try again.');
    }
}
window.updateEventDetails = updateEventDetails;

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
